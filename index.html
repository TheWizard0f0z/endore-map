<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa z Edytowalnymi Znacznikami</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        body {
            	margin: 0;
	    	background-color: #2a2a2a;
        }
        #map {
            	height: 100vh;
            	background-color: #2a2a2a;
        }
        #menu {
		position: absolute;
            	top: 0;
            	left: 0;
            	width: 250px;
            	height: 100%;
            	background-color: #292929c0;
            	backdrop-filter: blur(6px);
            	color: rgb(150, 150, 150);
            	padding: 0 20px;
            	box-shadow: 5px 0 15px rgba(0, 0, 0, 0.7);
            	z-index: 1000;
            	font-family: 'Cinzel', serif;
            	transition: transform 0.3s ease-in-out;
            	overflow-y: auto;
            	overflow-x: hidden;
            	scrollbar-color: #8b5e3c #2a2a2a;
    	    	scrollbar-width: thin;
        }
        .menu-section {
            	margin-bottom: 20px;
            	padding-bottom: 10px;
            	border-bottom: 1px solid rgb(150, 150, 150);
        }
        .menu-logo {
    	    	display: block;
            	border-radius: 50%;
    	    	margin: auto;
	    	padding-top: 10px;
		}
		.auth-buttons {
    		display: flex; /* Ustawia kontener na flexbox */
    		justify-content: center; /* Wyśrodkowanie przycisków */
    		gap: 10px; /* Odstęp między przyciskami */
		}
        #menu .login-btn, #menu .register-btn, #menu .logout-btn {
            	display: block;
		flex: none;
            	margin: 0 auto 10px;
            	padding: 10px 20px;
            	text-align: center;
            	background: #6b4226;
            	color: #f4e9c5;
            	border: 2px solid #c69c6d;
            	border-radius: 5px;
            	cursor: pointer;
            	text-decoration: none;
        }
        #menu .login-btn:hover, #menu .register-btn:hover {
            	background: #8b5e3c;
        }
        #menu h2 {
            	margin-top: 20px;
            	font-size: 1.2em;
            	text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
        }
        #menu ul {
            	list-style: none;
            	padding: 0;
            	margin: 10px 0;
        }
        #menu ul li {
            	color: rgb(215, 215, 215);
            	display: flex;
            	align-items: center;
            	margin: 5px 0;
        }
        #menu ul li input {
            	margin-right: 10px;
            	appearance: none;
            	width: 20px;
            	height: 20px;
            	border: 2px solid #c69c6d;
            	border-radius: 5px;
            	cursor: pointer;
            	position: relative;
        }
        #menu ul li input:checked {
            	background-color: #c69c6d;
        }
        #menu ul li input:checked::before {
            	content: '✓'; /* Znak wyboru */
    	    	color: #fff;
    	    	font-size: 16px;
    	    	position: absolute;
    	    	top: 50%;
    	    	left: 50%;
    	    	transform: translate(-50%, -50%);
        }
        #dialog {
            	position: absolute;
            	top: 50%;
            	left: 50%;
            	transform: translate(-50%, -50%);
            	background: rgba(0, 0, 0, 0.4);
            	padding: 20px;
            	border: 5px solid #c69c6d;
            	box-shadow: 0 0 15px #000, 0 0 25px #6b4226;
            	border-radius: 15px;
            	color: #f4e9c5;
            	display: none;
            	z-index: 1000;
            	font-family: 'Cinzel', serif;
        }
        #dialog h3 {
            	color: #f4e9c5;
            	margin-bottom: 15px;
            	text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
            	font-size: 1.5em;
        }
        #dialog input, #dialog select {
            	display: block;
            	margin: 10px 0;
            	width: 100%;
    	    	width: -moz-available;          /* WebKit-based browsers will ignore this. */
    	    	width: -webkit-fill-available;  /* Mozilla-based browsers will ignore this. */
    	    	width: fill-available;
            	padding: 8px;
            	border: 2px solid #c69c6d;
            	background-color: #f4e9c5;
            	color: #3e2723;
            	border-radius: 5px;
            	outline: none;
            	font-family: 'Cinzel', serif;
            	box-shadow: inset 0 0 5px #000;
        }
        #dialog button {
            	margin-top: 10px;
            	padding: 8px 12px;
            	background-color: #6b4226;
            	border: 1px solid rgba(128, 64, 0, 0.9);
            	color: #f4e9c5;
            	font-family: 'Cinzel', serif;
            	border-radius: 5px;
            	cursor: pointer;
            	box-shadow: 0 0 10px #000, 0 0 15px #6b4226;
        }
        #dialog button:hover {
            	background-color: #8b5e3c;
            	box-shadow: 0 0 20px #000, 0 0 25px #8b5e3c;
        }
        #deleteMarkerButton {
            	background: linear-gradient(145deg, rgba(128, 0, 0, 1) 0%, rgba(80, 0, 0, 1) 100%);
            	color: #6b4226;
        }
        #deleteMarkerButton:hover {
            	background: linear-gradient(145deg, rgba(150, 0, 0, 1) 0%, rgba(100, 0, 0, 1) 100%);
        }
        #overlay {
            	position: absolute;
            	top: 0;
            	left: 0;
            	width: 100%;
            	height: 100%;
            	background: rgba(0, 0, 0, 0.5);
            	display: none;
            	z-index: 999;
        }
	#cursor-coordinates {
            	background-color: rgba(0, 0, 0, 0.4);
            	border-radius: 5px;
            	padding: 10px;
    	    	font-size: 14px;
    	    	color: rgb(215, 215, 215);
    	    	margin: 10px 0;
    	    	text-align: center;
		}
    	#marker-section input, #registerForm input, #loginForm input {
    	    	width: 100%;
    	    	width: -moz-available;          /* WebKit-based browsers will ignore this. */
    	    	width: -webkit-fill-available;  /* Mozilla-based browsers will ignore this. */
    	    	width: fill-available;
    	    	margin: 5px 0;
    	    	padding: 8px;
    	    	border: 2px solid #c69c6d;
    	    	border-radius: 5px;
    	    	background-color: #f4e9c5;
    	    	color: #3e2723;
    	    	font-family: 'Cinzel', serif;
    	    	box-shadow: inset 0 0 5px #000;
		}
	#marker-section button {
    	    	width: 100%;
    	    	padding: 10px;
    	    	background-color: #6b4226;
    	    	border: 2px solid #c69c6d;
    	    	color: #f4e9c5;
    	    	border-radius: 5px;
    	    	cursor: pointer;
    	    	font-family: 'Cinzel', serif;
	}
	#marker-section button:hover {
    	    	background-color: #8b5e3c;
	}
    	.blinking-marker {
    	    	animation: blink 1s steps(2, start) 5; /* 5 cykli */
	}
	@keyframes blink {
    	    	to {
        		visibility: hidden;
		}
	}
    	.toggle-menu-button {
    	    	position: absolute;
    	    	top: 10px;
    	    	left: 291px;
    	    	z-index: 1001;
    	    	background-color: #6b4226;
    	    	color: #f4e9c5;
    	    	border: none;
    	    	padding: 10px 15px;
    	    	font-size: 18px;
    	    	cursor: pointer;
    	    	border-radius: 2px;
    	    	box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.7);
    	    	transition: left 0.3s;
	}
	.toggle-menu-button:hover {
    	    	background-color: #8b5e3c;
	}
	.leaflet-left {
    	    	left: 281px;
	    	top: 50px;
            	transition: left 0.3s;
	}
    	.leaflet-touch .leaflet-control-layers, .leaflet-touch .leaflet-bar {
    	    	border: none;
    	    	box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.7);
	}
    	.leaflet-touch .leaflet-bar a:first-child, .leaflet-touch .leaflet-bar a:last-child {
    	    	background-color: #6b4226;
    	    	color: #f4e9c5;
	}
    	.leaflet-touch .leaflet-bar a:first-child:hover, .leaflet-touch .leaflet-bar a:last-child:hover {
		background-color: #8b5e3c;
	}
	.select2-container .select2-selection--single {
	    	height: 36px;
	    	line-height: 38px;
            	background-color: #f4e9c5;
            	box-shadow: inset 0 0 5px #000;
            	border: 2px solid #c69c6d;
            	border-radius: 5px;
	}
	.select2-container--default .select2-selection--single .select2-selection__rendered {
	    	color: #404040;
	    	font-family: 'Cinzel', serif;
            	font-size: 13px;
		line-height: 32px;
	}
    	.select2-container--default .select2-selection--single .select2-selection__arrow {
        	top: 5px;
    	}
    	input::placeholder {
        	color: rgb(150, 150, 150);
	}
    	.select2-dropdown {
    		background-color: #f4e9c5; /* Tło listy */
    		box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5); /* Cień */
    		color: #404040; /* Kolor tekstu */
            	overflow-y: auto;
            	overflow-x: hidden;
            	scrollbar-color: #8b5e3c #2a2a2a;
    	    	scrollbar-width: thin;
	}
        .select2-container--default .select2-results > .select2-results__options {
    		overflow-y: visible;
	}
    	.select2-results__option {
    		height: 30px;
    		padding: 0; /* Wewnętrzne marginesy */
            	font-size: 13px;
            	overflow-y: visible;
	}
    	.select2-results__option:hover {
    		background-color: #928B76 !important; /* Kolor tła przy najechaniu */
	}
    
    .password-container {
    	position: relative;
    	display: inline-block;
        width: -webkit-fill-available;
	}

	#togglePasswordVisibilityRegister, #togglePasswordVisibilityLogin {
    	position: absolute;
    	right: 10px;
    	top: 50%;
    	transform: translateY(-50%);
    	background: transparent;
    	border: none;
    	cursor: pointer;
	}

	#togglePasswordVisibilityRegister i, #togglePasswordVisibilityLogin i {
    	font-size: 20px;
	}

        
    </style>
</head>
<body>
	<div id="menu">
		<div class="menu-section">
			<a href="https://wiki.endore.pl" target="_blank">
        			<img src="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/media/wikilogofinal.gif" alt="Logo" class="menu-logo">
			</a>
        	</div>
		<div id="loadingIndicator" style="display:none;">Ładowanie...</div>
        	<div class="menu-section auth-buttons">
        		<button id="protectedDataButton">Fetch Protected Data</button>
        	</div>
        	<div class="menu-section">
        		<form id="registerForm">
    				<input type="text" name="username" placeholder="Username" required />
                    <div class="password-container">
    					<input type="password" name="password" placeholder="Password" required id="passwordFieldRegister"/>
                    	<button type="button" id="togglePasswordVisibilityRegister">
            				<i id="eyeIconRegister" class="fa fa-eye-slash"></i> <!-- Ikona oka -->
        				</button>
                    </div>
    				<button type="submit" class="register-btn">Register</button>
				</form>
            	<form id="loginForm">
    				<input type="text" name="username" placeholder="Username" required />
                    <div class="password-container">
    					<input type="password" name="password" placeholder="Password" required id="passwordFieldLogin"/>
    					<button type="button" id="togglePasswordVisibilityLogin">
            				<i id="eyeIconLogin" class="fa fa-eye-slash"></i> <!-- Ikona oka -->
        				</button>
                    </div>
                    <button type="submit" class="login-btn">Login</button>
				</form>
            	<button id="logoutButton" class="logout-btn" style="display: none;">Logout</button>
        	</div>
        	<div class="menu-section">
        		<ul>
            			<li><input type="checkbox" id="showDefault" checked /> Domyślny</li>
            			<li><input type="checkbox" id="showMiasto" checked /> Miasta</li>
				<li><input type="checkbox" id="showArena" checked /> Areny</li>
				<li><input type="checkbox" id="showLoch" checked /> Lochy</li>
				<li><input type="checkbox" id="showMob" checked /> Niebezpieczne lokacje</li>
				<li><input type="checkbox" id="showPotwor" checked /> Potwory</li>
                		<li><input type="checkbox" id="showZwierze" checked /> Zwierzęta</li>
				<li><input type="checkbox" id="showSkarb" checked /> Skarby</li>
                		<li><input type="checkbox" id="showZamek" checked /> Zamki</li>
                		<li><input type="checkbox" id="showMost" checked /> Mosty</li>
                		<li><input type="checkbox" id="showWoda" checked /> Woda</li>
        		</ul>
			<label>
        			<input type="checkbox" id="toggleMarkerTooltips" />
        			Pokaż dymki znaczników
    			</label>
        	</div>
     		<div class="menu-section" id="coordinates-section">
    			<p id="cursor-coordinates">Współrzędne: (0, 0)</p>
            		<label>
        			<input type="checkbox" id="showRawCoordinates" />
        			Pokaż surowe współrzędne
	    		</label>
		</div>
        	<div class="menu-section" id="marker-section">
        		<label for="lng-input">Długość geograficzna:</label>
    			<input type="number" id="lng-input" step="0.01" placeholder="Np. 20.00">
    			<label for="lat-input">Szerokość geograficzna:</label>
    			<input type="number" id="lat-input" step="0.01" placeholder="Np. 50.00">
    			<button id="add-temp-marker">Idź do</button>
		</div>   
    	</div>
    	<button id="toggle-menu-button" class="toggle-menu-button">☰</button>
    	<div id="overlay"></div>
    	<div id="dialog">
        	<h3>Dodaj lub edytuj znacznik</h3>
        	<label for="markerTitle">Nazwa znacznika:</label>
        	<input type="text" id="markerTitle" placeholder="Wprowadź nazwę">
        	<label for="markerIcon">Wybierz rodzaj ikony:</label>
        	<select id="groupSelect" style="width: 100%;">
        		<option value="Default">Domyślna</option>
            		<option value="Miasto">Miasta</option>
            		<option value="Arena">Areny</option>
            		<option value="Loch">Lochy</option>
            		<option value="Mob">Niebezpieczne lokacje</option>
            		<option value="Potwor">Potwory</option>
            		<option value="Zwierze">Zwierzęta</option>
            		<option value="Skarb">Skarby</option>
            		<option value="Inne">Inne</option>
        	</select>
        
        	<select id="markerIconDefault" class="marker-group" style="width: 100%; display: block;">
    			<option value="default" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/default.png">Domyślna</option>
        	</select>
		
        	<select id="markerIconMiasto" class="marker-group" style="width: 100%; display: none;">
    			<option value="miasto1" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto1.png">Miasto</option>
    			<option value="miasto2" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto2.png">Miasto</option>
			<option value="miasto3" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto3.png">Miasto</option>
    			<option value="miasto4" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto4.png">Miasto</option>
        	</select>
		
        	<select id="markerIconArena" class="marker-group" style="width: 100%; display: none;">
			<option value="arena1" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena1.png">Arena</option>
			<option value="arena2" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena2.png">Arena</option>
			<option value="arena3" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena3.png">Arena</option>
			<option value="arena4" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena4.png">Arena</option>
			<option value="arena5" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena5.png">Arena</option>
			<option value="arena6" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena6.png">Arena</option>
			<option value="arena7" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena7.png">Arena</option>
        	</select>
		
        	<select id="markerIconLoch" class="marker-group" style="width: 100%; display: none;">
			<option value="loch1" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch1.png">Loch</option>
			<option value="loch2" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch2.png">Loch</option>
			<option value="loch3" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch3.png">Loch</option>
			<option value="loch4" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch4.png">Loch</option>
			<option value="loch5" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch5.png">Loch</option>
			<option value="loch6" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch6.png">Loch</option>
			<option value="loch7" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch7.png">Loch</option>
        	</select>
		
        	<select id="markerIconMob" class="marker-group" style="width: 100%; display: none;">
			<option value="mob1nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB1NM.png">Niebezpieczna lokacja poz.1</option>
			<option value="mob2nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB2NM.png">Niebezpieczna lokacja poz.2</option>
			<option value="mob3nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB3NM.png">Niebezpieczna lokacja poz.3</option>
			<option value="mob4nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB4NM.png">Niebezpieczna lokacja poz.4</option>
			<option value="mob5nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB5NM.png">Niebezpieczna lokacja poz.5</option>
			<option value="mob6nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB6NM.png">Niebezpieczna lokacja poz.6</option>
			<option value="mob7nm" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB7NM.png">Niebezpieczna lokacja poz.7</option>

			<option value="mob1ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB1PS.png">Niebezpieczna lokacja poz.1</option>
			<option value="mob2ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB2PS.png">Niebezpieczna lokacja poz.2</option>
			<option value="mob3ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB3PS.png">Niebezpieczna lokacja poz.3</option>
			<option value="mob4ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB4PS.png">Niebezpieczna lokacja poz.4</option>
			<option value="mob5ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB5PS.png">Niebezpieczna lokacja poz.5</option>
			<option value="mob6ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB6PS.png">Niebezpieczna lokacja poz.6</option>
			<option value="mob7ps" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB7PS.png">Niebezpieczna lokacja poz.7</option>

			<option value="mob1sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB1SA.png">Niebezpieczna lokacja poz.1</option>
			<option value="mob2sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB2SA.png">Niebezpieczna lokacja poz.2</option>
			<option value="mob3sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB3SA.png">Niebezpieczna lokacja poz.3</option>
			<option value="mob4sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB4SA.png">Niebezpieczna lokacja poz.4</option>
			<option value="mob5sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB5SA.png">Niebezpieczna lokacja poz.5</option>
			<option value="mob6sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB6SA.png">Niebezpieczna lokacja poz.6</option>
			<option value="mob7sa" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB7SA.png">Niebezpieczna lokacja poz.7</option>

			<option value="mob1sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB1SP.png">Niebezpieczna lokacja poz.1</option>
			<option value="mob2sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB2SP.png">Niebezpieczna lokacja poz.2</option>
			<option value="mob3sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB3SP.png">Niebezpieczna lokacja poz.3</option>
			<option value="mob4sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB4SP.png">Niebezpieczna lokacja poz.4</option>
			<option value="mob5sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB5SP.png">Niebezpieczna lokacja poz.5</option>
			<option value="mob6sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB6SP.png">Niebezpieczna lokacja poz.6</option>
			<option value="mob7sp" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB7SP.png">Niebezpieczna lokacja poz.7</option>
        	</select>
		
        	<select id="markerIconPotwor" class="marker-group" style="width: 100%; display: none;">
			<option value="potworcyklop" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/cyklop.png">Cyklop</option>
			<option value="potworduch" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/duch.png">Duch</option>
			<option value="potworettin" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/ettin.png">Ettin</option>
			<option value="potworharpia" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/harpia.png">Harpia</option>
			<option value="potworlicz" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/licz.png">Licz</option>
			<option value="potwormumia" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/mumia.png">Mumia</option>
			<option value="potworogr" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/ogr.png">Ogr</option>
			<option value="potworork" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/ork.png">Ork</option>
			<option value="potwororkkapitan" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/orkkapitan.png">Uruk-hai</option>
			<option value="potworpająk" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/pająk.png">Pająk</option>
			<option value="potworskorpion" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/skorpion.png">Skorpion</option>
			<option value="potworsmok" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/smok.png">Smok</option>
			<option value="potworszkielet" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/szkielet.png">Szkielet</option>
			<option value="potwortroll" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/troll.png">Troll</option>
			<option value="potworwąż" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/wąż.png">Wąż</option>
			<option value="potworzombi" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/zombi.png">Zombi</option>
        	</select>
        
        	<select id="markerIconZwierze" class="marker-group" style="width: 100%; display: none;">
			<option value="zwierzekon1" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/zwierzeta/kon1.png">Koń</option>
			<option value="zwierzelama1" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/zwierzeta/lama1.png">Lama</option>
        	</select>
		
        	<select id="markerIconSkarb" class="marker-group" style="width: 100%; display: none;">
			<option value="skarb1" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb1.png">Skarb poz.1</option>
			<option value="skarb2" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb2.png">Skarb poz.2</option>
			<option value="skarb3" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb3.png">Skarb poz.3</option>
			<option value="skarb4" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb4.png">Skarb poz.4</option>
			<option value="skarb5" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb5.png">Skarb poz.5</option>
			<option value="skarb6" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb6.png">Skarb poz.6</option>
			<option value="skarb7" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb7.png">Skarb poz.7</option>
			<option value="skarb8" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb8.png">Skarb poz.8</option>
        	</select>
		
        	<select id="markerIconInne" class="marker-group" style="width: 100%; display: none;">
    			<option value="zamek" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/zamek.png">Zamek</option>
    			<option value="most" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/most.png">Most</option>
        		<option value="woda" data-icon="https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/woda.png">Woda</option>
		</select>
        
        	<button id="addMarkerButton">Dodaj znacznik</button>
        	<button id="deleteMarkerButton" style="display: none;">Usuń znacznik</button>
    	</div>
	<div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        const map = L.map('map', { minZoom: 1, maxZoom: 4 }).setView([0, 0], 1);
        const imageBounds = [[-85, -256], [85, 256]];
        L.imageOverlay('https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/mapa.jpg', imageBounds).addTo(map);
        map.fitBounds(imageBounds);

        const markers = [];
        const icons = {
            default: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/default.png',
                iconSize: [31, 31],
                iconAnchor: [15, 31],
                popupAnchor: [0, -31],
                shadowUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/robocze/default-shadow.png',
                shadowSize: [31, 31],
    			shadowAnchor: [11, 31]
            }),
            	miasto1: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto1.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
            	miasto2: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto2.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
            	miasto3: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto3.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
            	miasto4: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/miasta/miasto4.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

	    arena1: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena1.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		arena2: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena2.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		arena3: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena3.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		arena4: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena4.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		arena5: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena5.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		arena6: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena6.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		arena7: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/arena/arena7.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		loch1: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch1.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		loch2: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch2.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		loch3: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch3.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		loch4: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch4.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		loch5: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch5.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		loch6: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch6.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		loch7: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/lochy/loch7.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		mob1nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB1NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob2nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB2NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob3nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB3NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob4nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB4NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob5nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB5NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob6nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB6NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob7nm: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob1/MOB7NM.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		mob1ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB1PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob2ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB2PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob3ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB3PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob4ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB4PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob5ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB5PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob6ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB6PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob7ps: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob2/MOB7PS.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		mob1sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB1SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob2sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB2SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob3sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB3SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob4sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB4SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob5sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB5SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob6sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB6SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob7sa: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob3/MOB7SA.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		mob1sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB1SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob2sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB2SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob3sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB3SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob4sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB4SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob5sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB5SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob6sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB6SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		mob7sp: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/mob4/MOB7SP.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		potworcyklop: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/cyklop.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworduch: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/duch.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworettin: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/ettin.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworharpia: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/harpia.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworlicz: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/licz.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potwormumia: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/mumia.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworogr: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/ogr.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworork: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/ork.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potwororkkapitan: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/orkkapitan.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworpająk: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/pająk.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworskorpion: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/skorpion.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworsmok: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/smok.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworszkielet: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/szkielet.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potwortroll: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/troll.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworwąż: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/wąż.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		potworzombi: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/potwory/zombi.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		zwierzekon1: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/zwierzeta/kon1.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		zwierzelama1: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/zwierzeta/lama1.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		skarb1: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb1.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb2: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb2.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb3: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb3.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb4: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb4.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb5: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb5.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb6: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb6.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb7: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb7.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		skarb8: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/skarby/skarb8.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),

		zamek: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/zamek.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		most: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/most.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] }),
		woda: L.icon({ iconUrl: 'https://raw.githubusercontent.com/TheWizard0f0z/endore-map/refs/heads/main/ikony/inne/woda.png', iconSize: [31, 31], iconAnchor: [15, 31], popupAnchor: [0, -31] })
        };

	    const dialog = document.getElementById('dialog');
	    const overlay = document.getElementById('overlay');
	    const markerTitleInput = document.getElementById('markerTitle');
	    const markerIconSelect = document.getElementById('markerIcon');
	    const addMarkerButton = document.getElementById('addMarkerButton');
	    const deleteMarkerButton = document.getElementById('deleteMarkerButton');

	    const showDefaultCheckbox = document.getElementById('showDefault');
	    const showMiastoCheckbox = document.getElementById('showMiasto');
	    const showArenaCheckbox = document.getElementById('showArena');
	    const showLochCheckbox = document.getElementById('showLoch');
	    const showMobCheckbox = document.getElementById('showMob');
	    const showPotworCheckbox = document.getElementById('showPotwor');
            const showZwierzeCheckbox = document.getElementById('showZwierze');
	    const showSkarbCheckbox = document.getElementById('showSkarb');
	    const showZamekCheckbox = document.getElementById('showZamek');
	    const showMostCheckbox = document.getElementById('showMost');
	    const showWodaCheckbox = document.getElementById('showWoda');
	    
        let pendingLatLng = null;

// SELECT2
    // Funkcja do formatowania opcji w Select2, w tym wyświetlanie ikon
$(document).ready(function () {
    // Funkcja do formatowania opcji w Select2, w tym wyświetlanie ikon
    function formatIcon(option) {
        if (!option.id) {
            return option.text; // Jeśli nie ma ID, zwraca tylko tekst
        }
        const iconUrl = $(option.element).data('icon'); // Pobranie URL ikony
        return $('<span>')
            .append($('<img>', {
                src: iconUrl,
                css: {
                    width: '30px', // Ustalamy rozmiar ikony
                    height: '30px',
                    marginRight: '8px',
                    verticalAlign: 'middle',
                    paddingBottom: '2px'
                }
            }))
            .append(option.text);
    }

    // Inicjalizacja Select2 dla każdej grupy markerów
    $('.marker-group').each(function () {
        $(this).select2({
            templateResult: formatIcon,
            templateSelection: formatIcon,
            minimumResultsForSearch: -1, // Ukrycie pola wyszukiwania
            dropdownCssClass: 'custom-dropdown'
        });
    });

    // Obsługa zmiany opcji w #groupSelect
    document.getElementById('groupSelect').addEventListener('change', function () {
        const selectedGroup = this.value; // Pobierz wybraną wartość grupy

        // Ukryj wszystkie grupy markerów i ich kontenery Select2
        document.querySelectorAll('.marker-group').forEach(select => {
            select.style.display = 'none'; // Ukryj <select>
            select.disabled = true; // Dezaktywuj <select>

            // Ukryj kontener Select2 powiązany z <select>
            const select2Container = $(select).next('.select2-container');
            select2Container.hide(); // Ukryj kontener Select2
        });

        // Pokaż i aktywuj odpowiednią grupę
        const activeSelect = document.getElementById(`markerIcon${selectedGroup}`);
        if (activeSelect) {
            activeSelect.style.display = 'block'; // Pokaż aktywny <select>
            activeSelect.disabled = false; // Aktywuj <select>

            // Zainicjalizuj Select2 dla aktywnego selecta (jeśli jeszcze nie istnieje)
            if (!$(activeSelect).data('select2')) {
                $(activeSelect).select2({
                    templateResult: formatIcon,
                    templateSelection: formatIcon,
                    minimumResultsForSearch: -1, // Ukrycie pola wyszukiwania
                    dropdownCssClass: 'custom-dropdown'
                });
            }

            // Pokaż kontener Select2 dla aktywnego selecta
            const activeSelect2Container = $(activeSelect).next('.select2-container');
            activeSelect2Container.show(); // Pokaż kontener Select2
        }
    });

    // Inicjalizacja dla `defaultSelect`
    const defaultSelect = document.getElementById('markerIconDefault'); // Zakładamy, że ID to markerIconDefault
    if (defaultSelect) {
        $(defaultSelect).select2({
            templateResult: formatIcon,
            templateSelection: formatIcon,
            minimumResultsForSearch: -1, // Ukrycie pola wyszukiwania
            dropdownCssClass: 'custom-dropdown'
        });
    }
});

// Funkcja otwierająca dialog
function openDialog(lat, lng, markerToEdit = null) {
    pendingLatLng = { lat, lng, markerToEdit };

    // Resetuj wszystkie pola do wartości domyślnych
    markerTitleInput.value = ''; // Resetuj nazwę znacznika
    document.getElementById('groupSelect').value = 'Default'; // Resetuj grupę

    document.querySelectorAll('.marker-group').forEach(select => {
        select.style.display = 'none'; // Ukrycie elementów <select>
        select.disabled = true;
        const select2Container = $(select).next('.select2-container');
        select2Container.hide(); // Ukrycie kontenera Select2
    });

    // Pokaż okienko `.marker-group` dla wartości domyślnej
    const defaultSelect = document.getElementById('markerIconDefault'); // Zakładamy, że ID to markerIconDefault
    if (defaultSelect) {
        defaultSelect.value = 'default'; // Ustaw wartość domyślną
        defaultSelect.style.display = 'block'; // Pokaż aktywny <select>
        defaultSelect.disabled = false;

        // Jeśli Select2 już istnieje, odśwież widok wybranej opcji
        if ($(defaultSelect).data('select2')) {
            $(defaultSelect).val('default').trigger('change.select2'); // Ustaw wartość i odśwież
        } else {
            // Inicjalizacja Select2 z domyślną funkcją formatowania
            $(defaultSelect).select2({
                templateResult: formatIcon,
                templateSelection: formatIcon,
                minimumResultsForSearch: -1,
                dropdownCssClass: 'custom-dropdown'
            });
            $(defaultSelect).val('default').trigger('change.select2');
        }

        // Pokaż kontener Select2
        const defaultSelect2Container = $(defaultSelect).next('.select2-container');
        defaultSelect2Container.show();
    }

    // Ustawianie znaczników dla edycji
    if (markerToEdit) {
        const activeSelect = document.getElementById(`markerIcon${markerToEdit.iconType}`);
        if (activeSelect) {
            activeSelect.value = markerToEdit.iconType;
            activeSelect.style.display = 'block';
            activeSelect.disabled = false;

            $(activeSelect).select2({
                templateResult: formatIcon,
                templateSelection: formatIcon,
                minimumResultsForSearch: -1,
                dropdownCssClass: 'custom-dropdown'
            });

            const activeSelect2Container = $(activeSelect).next('.select2-container');
            activeSelect2Container.show();
        }
    }

    addMarkerButton.textContent = markerToEdit ? "Zapisz zmiany" : "Dodaj znacznik";
    deleteMarkerButton.style.display = markerToEdit ? 'block' : 'none';

    dialog.style.display = 'block';
    overlay.style.display = 'block';
}




// CLOSE DIALOG
        function closeDialog() {
            dialog.style.display = 'none';
            overlay.style.display = 'none';
        }
        
        
// ADDORUPDATEMARKER
        async function addOrUpdateMarker() {
    		const title = markerTitleInput.value.trim();
    		const selectedGroup = document.getElementById('groupSelect').value;
    		const markerIconSelect = document.getElementById(`markerIcon${selectedGroup}`);
    		const iconType = markerIconSelect ? markerIconSelect.value : 'default';

    		if (!title) {
        		alert("Proszę podać nazwę znacznika.");
        	return;
    		}

    		if (pendingLatLng.markerToEdit) {
        		const markerData = markers.find(m => m.marker === pendingLatLng.markerToEdit.marker);
        		if (markerData) {
            			markerData.title = title;
            			markerData.group = selectedGroup;
            			markerData.iconType = iconType;
            			await updateMarkerOnServer(markerData);
        		}
    		} else {
        		await addMarkerToServer(pendingLatLng.lat, pendingLatLng.lng, title, selectedGroup, iconType);
    		}

    		closeDialog();
	}

        function removeMarker(markerToEdit) {
            if (confirm("Czy na pewno chcesz usunąć ten znacznik?")) {
                map.removeLayer(markerToEdit.marker);
                const index = markers.findIndex(m => m.marker === markerToEdit.marker);
                if (index !== -1) {
                    markers.splice(index, 1);
                }
                closeDialog();
            }
        }

        function toggleMarkers(type, isVisible) {
            markers.forEach(({ marker, iconType }) => {
                if (iconType.includes(type)) {
                    isVisible ? marker.addTo(map) : map.removeLayer(marker);
                }
            });
        }

        showDefaultCheckbox.addEventListener('change', (e) => {
            toggleMarkers('default', e.target.checked);
        });
        showMiastoCheckbox.addEventListener('change', (e) => {
            toggleMarkers('miasto', e.target.checked);
        });
	showArenaCheckbox.addEventListener('change', (e) => {
            toggleMarkers('arena', e.target.checked);
        });
	showLochCheckbox.addEventListener('change', (e) => {
            toggleMarkers('loch', e.target.checked);
        });
	showMobCheckbox.addEventListener('change', (e) => {
            toggleMarkers('mob', e.target.checked);
        });
	showPotworCheckbox.addEventListener('change', (e) => {
            toggleMarkers('potwor', e.target.checked);
        });
    showZwierzeCheckbox.addEventListener('change', (e) => {
            toggleMarkers('zwierze', e.target.checked);
        });
	showSkarbCheckbox.addEventListener('change', (e) => {
            toggleMarkers('skarb', e.target.checked);
        });
        showZamekCheckbox.addEventListener('change', (e) => {
            toggleMarkers('zamek', e.target.checked);
        });
        showMostCheckbox.addEventListener('change', (e) => {
            toggleMarkers('most', e.target.checked);
        });
	showWodaCheckbox.addEventListener('change', (e) => {
            toggleMarkers('woda', e.target.checked);
        });

        deleteMarkerButton.addEventListener('click', () => {
            if (pendingLatLng.markerToEdit) {
                removeMarker(pendingLatLng.markerToEdit);
            }
        });

	// Pobierz referencję do checkboxa
	const toggleMarkerTooltipsCheckbox = document.getElementById('toggleMarkerTooltips');

	// Funkcja do pokazywania lub ukrywania dymków
	function toggleMarkerTooltips(showTooltips) {
    		markers.forEach(({ marker }) => {
        		if (showTooltips) {
            			marker.openTooltip();
        		} else {
            			marker.closeTooltip();
       			 }
    		});
	}

	// Nasłuch na zmianę stanu checkboxa
	toggleMarkerTooltipsCheckbox.addEventListener('change', (e) => {
    		toggleMarkerTooltips(e.target.checked);
	});
        
        function transformCoordinates(lat, lng) {
    		const radians = lat * (Math.PI / 180); // Przelicz szerokość na radiany
    		const mercatorY = Math.log(Math.tan(Math.PI / 4 + radians / 2)); // Pseudomerkator
    		const normalizedY = (1 - (mercatorY / Math.PI)) / 2; // Normalizacja do [0, 1]

    		const visualX = ((lng + 256) / 512) * 6144; // Bez zmian
    		const visualY = normalizedY * 4096; // Dopasowanie do wysokości mapy

    		return { x: visualX.toFixed(0), y: visualY.toFixed(0) };
		}
        
        	const cursorCoordinates = document.getElementById('cursor-coordinates');

/* oryginalna funckja bez pokazywania surowych współrzędnych
	map.on('mousemove', (e) => {
    		const lat = e.latlng.lat;
    		const lng = e.latlng.lng;

    		if (
        		lat >= imageBounds[0][0] && lat <= imageBounds[1][0] &&
        		lng >= imageBounds[0][1] && lng <= imageBounds[1][1]
    		) {
        		const transformed = transformCoordinates(lat, lng);
        		cursorCoordinates.textContent = `Współrzędne: (${transformed.x}, ${transformed.y})`;
    		} else {
        		cursorCoordinates.textContent = "Współrzędne: (0, 0)";
    		}
	});
*/

		const showRawCoordinatesCheckbox = document.getElementById('showRawCoordinates');

	map.on('mousemove', (e) => {
    		const lat = e.latlng.lat;
    		const lng = e.latlng.lng;

    		if (
        		lat >= imageBounds[0][0] && lat <= imageBounds[1][0] &&
        		lng >= imageBounds[0][1] && lng <= imageBounds[1][1]
    		) {
        		if (showRawCoordinatesCheckbox.checked) {
            			cursorCoordinates.textContent = `Współrzędne surowe: (${lat.toFixed(0)}, ${lng.toFixed(0)})`;
        		} else {
            			const transformed = transformCoordinates(lat, lng);
            			cursorCoordinates.textContent = `Współrzędne: (${transformed.x}, ${transformed.y})`;
        		}
    		} else {
        		cursorCoordinates.textContent = "Współrzędne: (0, 0)";
    		}
	});
    
		// Obsługa aktywacji odpowiedniego <select> na podstawie wyboru grupy
    document.getElementById('groupSelect').addEventListener('change', function () {
        const selectedGroup = this.value; // Pobierz wybraną wartość grupy
        
        // Ukryj wszystkie grupy markerów
        document.querySelectorAll('.marker-group').forEach(select => {
            select.style.display = 'none'; // Ukryj
            select.disabled = true; // Dezaktywuj
        });

        // Pokaż i aktywuj odpowiednią grupę
        const activeSelect = document.getElementById(`markerIcon${selectedGroup}`);
        if (activeSelect) {
            activeSelect.style.display = 'block'; // Pokaż aktywny
            activeSelect.disabled = false; // Aktywuj
        }
    });

        function inverseTransformCoordinates(x, y) {
    		const lng = (x / 6144) * 512 - 256;

    		// Normalizacja współrzędnej Y do zakresu pseudomerkatora
    		const normalizedY = 1 - (y / 4096);

    		// Odwrotność pseudomerkatora
    		const mercatorY = Math.PI * (2 * normalizedY - 1);
    		const lat = (2 * Math.atan(Math.exp(mercatorY)) - Math.PI / 2) * (180 / Math.PI); // Radians to degrees

    		return { lat: lat.toFixed(2), lng: lng.toFixed(2) };
		}

	map.on('mouseout', () => {
    		cursorCoordinates.textContent = "Współrzędne: (0, 0)";
	});
        
        document.getElementById('add-temp-marker').addEventListener('click', () => {
    		const x = parseFloat(document.getElementById('lng-input').value);
    		const y = parseFloat(document.getElementById('lat-input').value);

    		if (isNaN(x) || isNaN(y)) {
        		alert("Proszę wprowadzić poprawne współrzędne.");
        		return;
    		}

    		const { lat, lng } = inverseTransformCoordinates(x, y);

    		if (
        		lat < imageBounds[0][0] || lat > imageBounds[1][0] ||
        		lng < imageBounds[0][1] || lng > imageBounds[1][1]
    		) {
        		alert("Współrzędne znajdują się poza obszarem mapy.");
        		return;
    		}

    		// Dodaj znacznik
    		const tempMarker = L.marker([lat, lng], {
        		icon: L.icon({
            		iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            		iconSize: [25, 41],
            		iconAnchor: [12, 41],
            		popupAnchor: [1, -34],
            		shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            		shadowSize: [41, 41],
            		className: 'blinking-marker' // Klasa do migania
        		})
    		}).addTo(map);

    		// Przybliż mapę
    		map.setView([lat, lng], 4);

    		// Efekt migania
    		let blinkCount = 0;
    		const blinkInterval = setInterval(() => {
        		const markerElement = tempMarker._icon;
        		if (markerElement) {
            			markerElement.style.visibility = (markerElement.style.visibility === 'hidden') ? 'visible' : 'hidden';
        		}
        		blinkCount++;
        		if (blinkCount >= 10) { // 5 migań (widoczne/niewidoczne)
            			clearInterval(blinkInterval);
            			map.removeLayer(tempMarker); // Usuń znacznik
        		}
    		}, 500);
		});
        
        const menu = document.getElementById('menu');
		const toggleButton = document.getElementById('toggle-menu-button');
    	const zoomButton = document.querySelector('.leaflet-left');

	// Flaga określająca, czy menu jest widoczne
	let menuVisible = true;

	toggleButton.addEventListener('click', () => {
    		if (menuVisible) {
        		menu.style.transform = 'translateX(-100%)'; // Ukryj menu
        		toggleButton.style.left = '10px'; // Przesuń przycisk w lewo
        		zoomButton.style.left = '15px';
        		menuVisible = false;
    		} else {
        		menu.style.transform = 'translateX(0)'; // Pokaż menu
        		toggleButton.style.left = '291px'; // Przywróć pozycję przycisku
        		zoomButton.style.left = '281px'; // Przywróć pozycję przycisku
        		menuVisible = true;
    		}
	});

        map.on('click', (e) => {
		const lat = e.latlng.lat;
		const lng = e.latlng.lng;
		if (lat < imageBounds[0][0] || lat > imageBounds[1][0] || lng < imageBounds[0][1] || lng > imageBounds[1][1]) {
			alert("Znacznik można dodać tylko w obszarze mapy.");
			return;
		}
		openDialog(lat, lng);
        });

        addMarkerButton.addEventListener('click', addOrUpdateMarker);
        overlay.addEventListener('click', closeDialog);

        function updateMarkersWithTransformedCoordinates() {
    		markers.forEach(({ marker, title, lat, lon }) => {
        		// Transformacja współrzędnych
        		const { x, y } = transformCoordinates(lat, lon);

        		// Dodanie dymka
        		marker.unbindTooltip(); // Usuń poprzedni dymek, jeśli istnieje
        		marker.bindTooltip(`<strong>${title}</strong><br>Pozycja: [${x}, ${y}]`);
    		});
	}
        
        function addMarker(lat, lng, icon, title, iconType) {
    		// Transformacja współrzędnych
    		const { x, y } = transformCoordinates(lat, lng);

    		// Tworzenie znacznika
    		const marker = L.marker([lat, lng], { icon }).addTo(map);

    		// Dodanie dymka
    		marker.bindTooltip(`<strong>${title}</strong><br>Pozycja: [${x}, ${y}]`);

    		// Dodanie znacznika do tablicy
    		markers.push({ marker, title, iconType, lat, lon: lng });
	}

        function addDefaultMarkers() {
    		// Dodaj przykładowe znaczniki, które będą widoczne dla niezalogowanych użytkowników
    		addMarker(63, -71, icons.miasto1, 'Bree', 'miasto');
    		addMarker(67, -195, icons.miasto2, 'Ered Luin', 'miasto');
    		addMarker(67, 2, icons.miasto4, 'Rivendell', 'miasto');
    		addMarker(20, -41, icons.miasto3, 'Tharbad', 'miasto');
	}
        
        
//BACKEND     
        async function fetchWithAuth(url, options = {}) {
    		const token = localStorage.getItem('token'); // Pobierz token z localStorage
    		if (!options.headers) options.headers = {};
    		options.headers['Authorization'] = token ? `Bearer ${token}` : '';

    		try {
        		const response = await fetch(url, options);
        		if (response.status === 401) {
            			alert('Unauthorized! Please log in again.');
            			localStorage.removeItem('token');
        		}
        		return response.json();
    		} catch (error) {
        		console.error('Error fetching data:', error);
        		alert('There was an error fetching the data.');
    		}
	}
        
        // Ukrywanie/wyświetlanie przycisków
	function toggleButtons() {
    		const token = localStorage.getItem('token');
    		if (!token) {
        		document.getElementById('protectedDataButton').style.display = 'none';
        		document.getElementById('logoutButton').style.display = 'none';
        		document.getElementById('loginForm').style.display = 'block'; // Zabezpiecz również przycisk logowania
        		document.getElementById('registerForm').style.display = 'block'; // I przycisk rejestracji
    		} else {
        		document.getElementById('protectedDataButton').style.display = 'block';
        		document.getElementById('logoutButton').style.display = 'block';
        		document.getElementById('loginForm').style.display = 'none';
        		document.getElementById('registerForm').style.display = 'none';
    		}
	}

	// Event listener, który wywoła toggleButtons po załadowaniu strony
	document.addEventListener('DOMContentLoaded', () => {
    		toggleButtons();  // Sprawdź, czy użytkownik jest zalogowany i ustaw przyciski
		const token = localStorage.getItem('token'); // Pobierz token z localStorage
    		if (token) {
        		loadMarkers(); // 🟢 Wywołaj loadMarkers, aby pobrać znaczniki użytkownika
    		}
        	addDefaultMarkers(); // Dodaj przykładowe znaczniki, które będą widoczne dla każdego użytkownika
	});
        
        // Obsługa formularza rejestracji
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
    		e.preventDefault();
    		const username = e.target.username.value;
    		const password = e.target.password.value;

    		const response = await fetch('https://endore-map.onrender.com/auth/register', {
        		method: 'POST',
        		headers: { 'Content-Type': 'application/json' },
        		body: JSON.stringify({ username, password }),
    		});

    		const data = await response.json();
    		console.log(data); // Obsłuż odpowiedź

		if (data.message === 'User registered') {
			alert('Register successfully!');
			toggleButtons();  // Ustaw przyciski po rejestracji
			document.getElementById('registerForm').reset(); // Wyczyść formularz po rejestracji
		} else {
			alert('Register failed');
		}
	});
        
        // Obsługa formularza logowania
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
    		e.preventDefault();
    		const username = e.target.username.value;
    		const password = e.target.password.value;

    		const response = await fetch('https://endore-map.onrender.com/auth/login', {
        		method: 'POST',
        		headers: { 'Content-Type': 'application/json' },
        		body: JSON.stringify({ username, password }),
    		});

    		const data = await response.json();
    		if (data.token) {
        		localStorage.setItem('token', data.token); // Zapis tokena
			console.log("Token saved:", data.token);
        		alert('Logged in successfully!');
			toggleButtons();  // Zaktualizuj widoczność przycisków po zalogowaniu
			document.getElementById('loginForm').reset(); // Wyczyść formularz po logowaniu
			await loadMarkers(); // 🟢 Wywołaj funkcję loadMarkers po zalogowaniu
			addDefaultMarkers(); // 🟢 Dodaj przykładowe znaczniki po zalogowaniu
    		} else {
        		alert('Login failed');
    		}
	});
        
        // Obsługa wylogowania
        document.getElementById('logoutButton').addEventListener('click', () => {
    		// Usuń token z localStorage
    		localStorage.removeItem('token');
		// Usuń wszystkie znaczniki użytkownika z mapy
    		markers.forEach(({ marker }) => map.removeLayer(marker));
    		// Wyczyść tablicę przechowującą znaczniki użytkownika
    		markers.length = 0;
    		alert('Logged out successfully!');
		toggleButtons();  // Zaktualizuj widoczność przycisków po wylogowaniu
		// Opcjonalnie wyczyść formularze
    		document.getElementById('loginForm').reset(); // Wyczyść formularz logowania
    		document.getElementById('registerForm').reset(); // Wyczyść formularz rejestracji
		// Dodaj przykładowe znaczniki z powrotem
    		addDefaultMarkers();  // Ponownie dodaj przykładowe znaczniki
	});

	// Przykład użycia:
	document.getElementById('protectedDataButton').addEventListener('click', async () => {
    		const data = await fetchWithAuth('https://endore-map.onrender.com/protected');
    		console.log(data); // Przetwórz dane z odpowiedzi
	});
    
    // Funkcja do obsługi widoczności hasła
	function setupPasswordToggle(passwordFieldId, toggleButtonId, eyeIconId) {
    	const passwordField = document.getElementById(passwordFieldId);
    	const toggleButton = document.getElementById(toggleButtonId);
    	const eyeIcon = document.getElementById(eyeIconId);

    	toggleButton.addEventListener('click', function () {
        	if (passwordField.type === 'password') {
            	passwordField.type = 'text'; // Ustaw widoczność hasła
            	eyeIcon.classList.remove('fa-eye-slash');
            	eyeIcon.classList.add('fa-eye'); // Zmień ikonę
        	} else {
            	passwordField.type = 'password'; // Ukryj hasło
            	eyeIcon.classList.remove('fa-eye');
            	eyeIcon.classList.add('fa-eye-slash'); // Zmień ikonę
        	}
    	});
	}

	// Zastosowanie funkcji dla rejestracji
	setupPasswordToggle('passwordFieldRegister', 'togglePasswordVisibilityRegister', 'eyeIconRegister');

	// Zastosowanie funkcji dla logowania
	setupPasswordToggle('passwordFieldLogin', 'togglePasswordVisibilityLogin', 'eyeIconLogin');

	// GET /markers Pobierz znaczniki dla zalogowanego użytkownika.
	async function loadMarkers() {
		document.getElementById('loadingIndicator').style.display = 'block'; // Pokaż wskaźnik ładowania
    		try {
        		// Pobierz token z localStorage
        		const token = localStorage.getItem('token');
        
        		// Upewnij się, że token istnieje
        		if (!token) {
            			throw new Error('Brak tokena uwierzytelniającego');
        		}

        		// Wykonaj żądanie GET do endpointa /markers
        		const response = await fetch('https://endore-map.onrender.com/markers', {
            			method: 'GET',
            			headers: { 
                			'Authorization': `Bearer ${token}` 
            			}
        		});

        		// Obsługa błędu, jeśli odpowiedź nie jest OK
        		if (!response.ok) {
            			const errorMessage = await response.text();
    				throw new Error(`Błąd podczas pobierania znaczników: ${response.status} - ${errorMessage}`);
        		}

        		// Przetwórz odpowiedź na JSON
        		const markersData = await response.json();
			if (!Array.isArray(markersData)) {
    				throw new Error('Niepoprawna odpowiedź API - oczekiwano tablicy znaczników');
			}

        		// Usuń wszystkie istniejące znaczniki z mapy
        		markers.forEach(({ marker }) => map.removeLayer(marker));
        		markers.length = 0; // Wyczyść tablicę znaczników

        		// Iteracja przez pobrane znaczniki i dodanie ich do mapy
        		markersData.forEach(markerData => {
            			const { title, iconType, coordinates } = markerData;
            			const icon = icons[iconType] || icons.default; // Użyj ikony na podstawie typu lub domyślnej
            			const mapMarker = L.marker([coordinates.lat, coordinates.lng], { icon }).addTo(map);

            			// Dodanie dymka (tooltipa) do znacznika
            			mapMarker.bindTooltip(`<strong>${title}</strong>`);

            			// Dodaj obsługę kliknięcia w znacznik, aby otworzyć okno edycji
            			mapMarker.on('click', () => openDialog(coordinates.lat, coordinates.lng, markerData));

            			// Dodaj znacznik do lokalnej tablicy znaczników
            			markers.push({ marker: mapMarker, ...markerData });
        		});

        		console.log('Znaczniki zostały pomyślnie załadowane');
    		} catch (error) {
        		console.error('Błąd podczas ładowania znaczników:', error);
        		alert('Nie udało się pobrać znaczników: ' + error.message);
    		} finally {
    			document.getElementById('loadingIndicator').style.display = 'none'; // Ukryj wskaźnik
		}
	}

	// POST /markers Podczas tworzenia nowego znacznika wyślij dane do API
	async function addMarkerToServer(lat, lng, title, group, iconType) {
    		try {
        		const response = await fetch('https://endore-map.onrender.com/markers', {
            			method: 'POST',
            			headers: {
                			'Content-Type': 'application/json',
                			'Authorization': `Bearer ${localStorage.getItem('token')}`,
            			},
            			body: JSON.stringify({
                			title,
                			group,
                			iconType,
                			coordinates: { lat, lng },
            			}),
        		});

        		if (!response.ok) {
            			throw new Error(`Błąd: ${response.statusText}`);
        		}

        		const newMarker = await response.json();
        		const icon = icons[iconType] || icons.default;
        		const marker = L.marker([lat, lng], { icon }).addTo(map);
        		marker.bindTooltip(`<strong>${title}</strong>`);

        		markers.push({
            			id: newMarker._id,
            			marker,
            			title,
            			group,
            			iconType,
        		});
    		} catch (error) {
        		console.error('Nie udało się dodać znacznika:', error);
    		}
	}

	// PUT /markers/:id Aktualizacja znacznika na serwerze i mapie
	async function updateMarkerOnServer(markerData) {
    		try {
        		const { id, title, group, iconType, marker } = markerData;
        		const response = await fetch(`https://endore-map.onrender.com/markers/${id}`, {
            			method: 'PUT',
            			headers: {
                			'Content-Type': 'application/json',
                			'Authorization': `Bearer ${localStorage.getItem('token')}`,
            			},
            			body: JSON.stringify({
                			title,
                			group,
                			iconType,
                			coordinates: marker.getLatLng(),
            			}),
        		});

        		if (!response.ok) {
            			throw new Error(`Błąd: ${response.statusText}`);
        		}

        		const updatedMarker = await response.json();
        		const icon = icons[iconType] || icons.default;
        		marker.setIcon(icon);
        		marker.setTooltipContent(`<strong>${title}</strong>`);
    		} catch (error) {
        		console.error('Nie udało się zaktualizować znacznika:', error);
    		}
	}

    </script>
</body>
</html>
